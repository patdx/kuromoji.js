var xe=Object.defineProperty;var Ve=(A,d,E)=>d in A?xe(A,d,{enumerable:!0,configurable:!0,writable:!0,value:E}):A[d]=E;var u=(A,d,E)=>Ve(A,typeof d!="symbol"?d+"":d,E);(function(){"use strict";var A=class{constructor(t,e,n,r,i,o,a,s){u(this,"start_pos");u(this,"length");u(this,"name");u(this,"cost");u(this,"left_id");u(this,"right_id");u(this,"prev");u(this,"surface_form");u(this,"shortest_cost");u(this,"type");this.name=t,this.cost=e,this.start_pos=n,this.length=r,this.left_id=o,this.right_id=a,this.prev=null,this.surface_form=s,i==="BOS"?this.shortest_cost=0:this.shortest_cost=Number.MAX_VALUE,this.type=i}},d=A,E=class{constructor(){u(this,"nodes_end_at");u(this,"eos_pos");this.nodes_end_at=[],this.nodes_end_at[0]=[new d(-1,0,0,0,"BOS",0,0,"")],this.eos_pos=1}append(t){const e=t.start_pos+t.length-1;this.eos_pos<e&&(this.eos_pos=e);let n=this.nodes_end_at[e];n==null&&(n=[]),n.push(t),this.nodes_end_at[e]=n}appendEos(){const t=this.nodes_end_at.length;this.eos_pos++,this.nodes_end_at[t]=[new d(-1,0,this.eos_pos,0,"EOS",0,0,"")]}},pt=E,dt=class ft{constructor(e){u(this,"length");u(this,"str");u(this,"index_mapping");this.str=e,this.index_mapping=[];for(let n=0;n<e.length;n++){const r=e.charAt(n);this.index_mapping.push(n),ft.isSurrogatePair(r)&&n++}this.length=this.index_mapping.length}slice(e){if(this.index_mapping.length<=e)return"";const n=this.index_mapping[e];return this.str.slice(n)}charAt(e){if(this.str.length<=e)return"";const n=this.index_mapping[e],r=this.index_mapping[e+1];return r==null?this.str.slice(n):this.str.slice(n,r)}charCodeAt(e){if(this.index_mapping.length<=e)return NaN;const n=this.index_mapping[e],r=this.str.charCodeAt(n);let i;return r>=55296&&r<=56319&&n<this.str.length&&(i=this.str.charCodeAt(n+1),i>=56320&&i<=57343)?(r-55296)*1024+i-56320+65536:r}toString(){return this.str}static isSurrogatePair(e){const n=e.charCodeAt(0);return n>=55296&&n<=56319}},O=dt,gt=class{constructor(t){u(this,"trie");u(this,"token_info_dictionary");u(this,"unknown_dictionary");this.trie=t.trie,this.token_info_dictionary=t.token_info_dictionary,this.unknown_dictionary=t.unknown_dictionary}build(t){const e=new pt,n=new O(t);let r,i,o,a,s;for(let c=0;c<n.length;c++){const l=n.slice(c),f=this.trie.commonPrefixSearch(l);for(let v=0;v<f.length;v++){i=f[v].v,r=f[v].k;const w=this.token_info_dictionary.target_map[i];for(let y=0;y<w.length;y++){const I=parseInt(w[y]);o=this.token_info_dictionary.dictionary.getShort(I),a=this.token_info_dictionary.dictionary.getShort(I+2),s=this.token_info_dictionary.dictionary.getShort(I+4),e.append(new d(I,s,c+1,r.length,"KNOWN",o,a,r))}}const h=new O(l),_=new O(h.charAt(0)),p=this.unknown_dictionary.lookup(_.toString());if(!p)throw new Error("Unknown character: "+_);if(f==null||f.length===0||p.is_always_invoke===1){if(r=_,p.is_grouping===1&&1<h.length)for(let w=1;w<h.length;w++){const y=h.charAt(w),I=this.unknown_dictionary.lookup(y);if(p.class_name!==I.class_name)break;r+=y}const v=this.unknown_dictionary.target_map[p.class_id];for(let w=0;w<v.length;w++){const y=parseInt(v[w]);o=this.unknown_dictionary.dictionary.getShort(y),a=this.unknown_dictionary.dictionary.getShort(y+2),s=this.unknown_dictionary.dictionary.getShort(y+4),e.append(new d(y,s,c+1,r.length,"UNKNOWN",o,a,r.toString()))}}}return e.appendEos(),e}},yt=gt,bt=class{constructor(t){u(this,"connection_costs");this.connection_costs=t}search(t){return t=this.forward(t),this.backward(t)}forward(t){let e,n,r;for(e=1;e<=t.eos_pos;e++){const i=t.nodes_end_at[e];if(i!=null)for(n=0;n<i.length;n++){const o=i[n];let a=Number.MAX_VALUE,s=null;const c=t.nodes_end_at[o.start_pos-1];if(c!=null){for(r=0;r<c.length;r++){const l=c[r];let f;o.left_id==null||l.right_id==null?(console.log("Left or right is null"),f=0):f=this.connection_costs.get(l.right_id,o.left_id);const h=l.shortest_cost+f+o.cost;h<a&&(s=l,a=h)}o.prev=s,o.shortest_cost=a}}}return t}backward(t){const e=[];let r=t.nodes_end_at[t.nodes_end_at.length-1][0].prev;if(r==null)return[];for(;r.type!=="BOS";){if(e.push(r),r.prev==null)return[];r=r.prev}return e.reverse()}},mt=bt,kt=class{formatEntry(t,e,n,r){const i={};return i.word_id=t,i.word_type=n,i.word_position=e,i.surface_form=r[0],i.pos=r[1],i.pos_detail_1=r[2],i.pos_detail_2=r[3],i.pos_detail_3=r[4],i.conjugated_type=r[5],i.conjugated_form=r[6],i.basic_form=r[7],i.reading=r[8],i.pronunciation=r[9],i}formatUnknownEntry(t,e,n,r,i){const o={};return o.word_id=t,o.word_type=n,o.word_position=e,o.surface_form=i,o.pos=r[1],o.pos_detail_1=r[2],o.pos_detail_2=r[3],o.pos_detail_3=r[4],o.conjugated_type=r[5],o.conjugated_form=r[6],o.basic_form=r[7],o}},wt=kt,vt=/、|。/,Ct=class ut{constructor(e){u(this,"token_info_dictionary");u(this,"unknown_dictionary");u(this,"viterbi_builder");u(this,"viterbi_searcher");u(this,"formatter");this.token_info_dictionary=e.token_info_dictionary,this.unknown_dictionary=e.unknown_dictionary,this.viterbi_builder=new yt(e),this.viterbi_searcher=new mt(e.connection_costs),this.formatter=new wt}tokenize(e){const n=ut.splitByPunctuation(e),r=[];for(let i=0;i<n.length;i++){const o=n[i];this.tokenizeForSentence(o,r)}return r}tokenizeForSentence(e,n){n==null&&(n=[]);const r=this.getLattice(e),i=this.viterbi_searcher.search(r);let o=0;n.length>0&&(o=n[n.length-1].word_position);for(let a=0;a<i.length;a++){const s=i[a];let c,l,f;s.type==="KNOWN"?(f=this.token_info_dictionary.getFeatures(s.name),f==null?l=[]:l=f.split(","),c=this.formatter.formatEntry(s.name,o+s.start_pos,s.type,l)):s.type==="UNKNOWN"?(f=this.unknown_dictionary.getFeatures(s.name),f==null?l=[]:l=f.split(","),c=this.formatter.formatUnknownEntry(s.name,o+s.start_pos,s.type,l,s.surface_form)):c=this.formatter.formatEntry(s.name,o+s.start_pos,s.type,[]),n.push(c)}return n}getLattice(e){return this.viterbi_builder.build(e)}static splitByPunctuation(e){const n=[];let r=e;for(;r!=="";){const i=r.search(vt);if(i<0){n.push(r);break}n.push(r.substring(0,i+1)),r=r.substring(i+1)}return n}},At=Ct,R="\0",x=0,g=0,b=-1,G=!0,$=!0,K=4,Y=4,St=2,X=function(t){t==null&&(t=1024);let e=function(s,c,l){for(let f=c;f<l;f++)s[f]=-f+1;if(0<a.array[a.array.length-1]){let f=a.array.length-2;for(;0<a.array[f];)f--;s[c]=-f}},n=function(s,c,l){for(let f=c;f<l;f++)s[f]=-f-1},r=function(s){let c=s*St,l=U(o.signed,o.bytes,c);e(l,o.array.length,c),l.set(o.array),o.array=null,o.array=l;let f=U(a.signed,a.bytes,c);n(f,a.array.length,c),f.set(a.array),a.array=null,a.array=f},i=g+1;var o={signed:G,bytes:K,array:U(G,K,t)},a={signed:$,bytes:Y,array:U($,Y,t)};return o.array[g]=1,a.array[g]=g,e(o.array,g+1,o.array.length),n(a.array,g+1,a.array.length),{getBaseBuffer:function(){return o.array},getCheckBuffer:function(){return a.array},loadBaseBuffer:function(s){return o.array=s,this},loadCheckBuffer:function(s){return a.array=s,this},size:function(){return Math.max(o.array.length,a.array.length)},getBase:function(s){return o.array.length-1<s?-s+1:o.array[s]},getCheck:function(s){return a.array.length-1<s?-s-1:a.array[s]},setBase:function(s,c){o.array.length-1<s&&r(s),o.array[s]=c},setCheck:function(s,c){a.array.length-1<s&&r(s),a.array[s]=c},setFirstUnusedNode:function(s){i=s},getFirstUnusedNode:function(){return i},shrink:function(){let s=this.size()-1;for(;!(0<=a.array[s]);)s--;o.array=o.array.subarray(0,s+2),a.array=a.array.subarray(0,s+2)},calc:function(){let s=0,c=a.array.length;for(let l=0;l<c;l++)a.array[l]<0&&s++;return{all:c,unused:s,efficiency:(c-s)/c}},dump:function(){let s="",c="",l;for(l=0;l<o.array.length;l++)s=s+" "+this.getBase(l);for(l=0;l<a.array.length;l++)c=c+" "+this.getCheck(l);return console.log("base:"+s),console.log("chck:"+c),"base:"+s+" chck:"+c}}};function C(t){this.bc=X(t),this.keys=[]}C.prototype.append=function(t,e){return this.keys.push({k:t,v:e}),this},C.prototype.build=function(t,e){if(t==null&&(t=this.keys),t==null)return new m(this.bc);e==null&&(e=!1);let n=t.map(function(r){return{k:N(r.k+R),v:r.v}});return e?this.keys=n:this.keys=n.sort(function(r,i){const o=r.k,a=i.k,s=Math.min(o.length,a.length);for(let c=0;c<s;c++)if(o[c]!==a[c])return o[c]-a[c];return o.length-a.length}),n=null,this._build(g,0,0,this.keys.length),new m(this.bc)},C.prototype._build=function(t,e,n,r){const i=this.getChildrenInfo(e,n,r),o=this.findAllocatableBase(i);this.setBC(t,i,o);for(let a=0;a<i.length;a=a+3){const s=i[a];if(s===x)continue;const c=i[a+1],l=i[a+2],f=o+s;this._build(f,e+1,c,l)}},C.prototype.getChildrenInfo=function(t,e,n){let r=this.keys[e].k[t],i=0,o=new Int32Array(n*3);o[i++]=r,o[i++]=e;let a=e,s=e;for(;a<e+n;a++){const c=this.keys[a].k[t];r!==c&&(o[i++]=a-s,o[i++]=c,o[i++]=a,r=c,s=a)}return o[i++]=a-s,o=o.subarray(0,i),o},C.prototype.setBC=function(t,e,n){const r=this.bc;r.setBase(t,n);let i;for(i=0;i<e.length;i=i+3){const o=e[i],a=n+o,s=-r.getBase(a),c=-r.getCheck(a);a!==r.getFirstUnusedNode()?r.setCheck(s,-c):r.setFirstUnusedNode(c),r.setBase(c,-s);const l=t;if(r.setCheck(a,l),o===x){const f=e[i+1];let h=this.keys[f].v;h==null&&(h=0);const _=-h-1;r.setBase(a,_)}}},C.prototype.findAllocatableBase=function(t){const e=this.bc;let n,r=e.getFirstUnusedNode();for(;;){if(n=r-t[0],n<0){r=-e.getCheck(r);continue}let i=!0;for(let o=0;o<t.length;o=o+3){const a=t[o],s=n+a;if(!this.isUnusedNode(s)){r=-e.getCheck(r),i=!1;break}}if(i)return n}},C.prototype.isUnusedNode=function(t){const n=this.bc.getCheck(t);return t===g?!1:n<0};function m(t){this.bc=t,this.bc.shrink()}m.prototype.contain=function(t){const e=this.bc;t+=R;const n=N(t);let r=g,i=b;for(let o=0;o<n.length;o++){const a=n[o];if(i=this.traverse(r,a),i===b)return!1;if(e.getBase(i)<=0)return!0;r=i}return!1},m.prototype.lookup=function(t){t+=R;const e=N(t);let n=g,r=b;for(let o=0;o<e.length;o++){const a=e[o];if(r=this.traverse(n,a),r===b)return b;n=r}const i=this.bc.getBase(r);return i<=0?-i-1:b},m.prototype.commonPrefixSearch=function(t){const e=N(t);let n=g,r=b;const i=[];for(let o=0;o<e.length;o++){const a=e[o];if(r=this.traverse(n,a),r!==b){n=r;const s=this.traverse(r,x);if(s!==b){const c=this.bc.getBase(s),l={};c<=0&&(l.v=-c-1),l.k=Tt(Et(e,0,o+1)),i.push(l)}continue}else break}return i},m.prototype.traverse=function(t,e){const n=this.bc.getBase(t)+e;return this.bc.getCheck(n)===t?n:b},m.prototype.size=function(){return this.bc.size()},m.prototype.calc=function(){return this.bc.calc()},m.prototype.dump=function(){return this.bc.dump()};var U=function(t,e,n){switch(e){case 1:return new Int8Array(n);case 2:return new Int16Array(n);case 4:return new Int32Array(n);default:throw new RangeError("Invalid newArray parameter element_bytes:"+e)}},Et=function(t,e,n){const r=new ArrayBuffer(n),i=new Uint8Array(r,0,n),o=t.subarray(e,n);return i.set(o),i},N=function(t){const e=new Uint8Array(new ArrayBuffer(t.length*4));let n=0,r=0;for(;n<t.length;){var i;const o=t.charCodeAt(n++);if(o>=55296&&o<=56319){const a=o,s=t.charCodeAt(n++);if(s>=56320&&s<=57343)i=(a-55296)*1024+65536+(s-56320);else return null}else i=o;i<128?e[r++]=i:i<2048?(e[r++]=i>>>6|192,e[r++]=i&63|128):i<65536?(e[r++]=i>>>12|224,e[r++]=i>>6&63|128,e[r++]=i&63|128):i<1<<21&&(e[r++]=i>>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=i&63|128)}return e.subarray(0,r)},Tt=function(t){let e="",n,r,i,o,a,s,c,l=0;for(;l<t.length;)r=t[l++],r<128?n=r:r>>5===6?(i=t[l++],n=(r&31)<<6|i&63):r>>4===14?(i=t[l++],o=t[l++],n=(r&15)<<12|(i&63)<<6|o&63):(i=t[l++],o=t[l++],a=t[l++],n=(r&7)<<18|(i&63)<<12|(o&63)<<6|a&63),n<65536?e+=String.fromCharCode(n):(n-=65536,s=55296|n>>10,c=56320|n&1023,e+=String.fromCharCode(s,c));return e};function It(t){return new C(t)}function Bt(t,e){let n=X(0);return n.loadBaseBuffer(t),n.loadCheckBuffer(e),new m(n)}var Ot=function(t){const e=new Uint8Array(t.length*4);let n=0,r=0;for(;n<t.length;){let i;const o=t.charCodeAt(n++);if(o>=55296&&o<=56319){const a=o,s=t.charCodeAt(n++);if(s>=56320&&s<=57343)i=(a-55296)*1024+65536+(s-56320);else return null}else i=o;i<128?e[r++]=i:i<2048?(e[r++]=i>>>6|192,e[r++]=i&63|128):i<65536?(e[r++]=i>>>12|224,e[r++]=i>>6&63|128,e[r++]=i&63|128):i<1<<21&&(e[r++]=i>>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=i&63|128)}return e.subarray(0,r)},Ut=function(t){let e="",n,r,i,o,a,s,c,l=0;for(;l<t.length;)r=t[l++],r<128?n=r:r>>5===6?(i=t[l++],n=(r&31)<<6|i&63):r>>4===14?(i=t[l++],o=t[l++],n=(r&15)<<12|(i&63)<<6|o&63):(i=t[l++],o=t[l++],a=t[l++],n=(r&7)<<18|(i&63)<<12|(o&63)<<6|a&63),n<65536?e+=String.fromCharCode(n):(n-=65536,s=55296|n>>10,c=56320|n&1023,e+=String.fromCharCode(s,c));return e},Nt=class{constructor(t){u(this,"buffer");u(this,"position");let e;if(t==null)e=1024*1024;else if(typeof t=="number")e=t;else if(t instanceof Uint8Array){this.buffer=t,this.position=0;return}else throw typeof t+" is invalid parameter type for ByteBuffer constructor";this.buffer=new Uint8Array(e),this.position=0}size(){return this.buffer.length}reallocate(){const t=new Uint8Array(this.buffer.length*2);t.set(this.buffer),this.buffer=t}shrink(){return this.buffer=this.buffer.subarray(0,this.position),this.buffer}put(t){this.buffer.length<this.position+1&&this.reallocate(),this.buffer[this.position++]=t}get(t){return t==null&&(t=this.position,this.position+=1),this.buffer.length<t+1?0:this.buffer[t]}putShort(t){if(65535<t)throw t+" is over short value";const e=255&t,n=(65280&t)>>8;this.put(e),this.put(n)}getShort(t){if(t==null&&(t=this.position,this.position+=2),this.buffer.length<t+2)return 0;const e=this.buffer[t];let r=(this.buffer[t+1]<<8)+e;return r&32768&&(r=-(r-1^65535)),r}putInt(t){if(4294967295<t)throw t+" is over integer value";const e=255&t,n=(65280&t)>>8,r=(16711680&t)>>16,i=(4278190080&t)>>24;this.put(e),this.put(n),this.put(r),this.put(i)}getInt(t){if(t==null&&(t=this.position,this.position+=4),this.buffer.length<t+4)return 0;const e=this.buffer[t],n=this.buffer[t+1],r=this.buffer[t+2];return(this.buffer[t+3]<<24)+(r<<16)+(n<<8)+e}readInt(){const t=this.position;return this.position+=4,this.getInt(t)}putString(t){const e=Ot(t);for(let n=0;n<e.length;n++)this.put(e[n]);this.put(0)}getString(t){const e=[];let n;for(t==null&&(t=this.position);!(this.buffer.length<t+1||(n=this.get(t++),n===0));)e.push(n);return this.position=t,Ut(e)}},k=Nt,zt=class{constructor(){u(this,"dictionary");u(this,"target_map");u(this,"pos_buffer");this.dictionary=new k(10*1024*1024),this.target_map={},this.pos_buffer=new k(10*1024*1024)}buildDictionary(t){const e={};for(let n=0;n<t.length;n++){const r=t[n];if(r.length<4)continue;const i=r[0],o=r[1],a=r[2],s=r[3],c=r.slice(4).join(",");(!isFinite(o)||!isFinite(a)||!isFinite(s))&&console.log(r);const l=this.put(o,a,s,i,c);e[l]=i}return this.dictionary.shrink(),this.pos_buffer.shrink(),e}put(t,e,n,r,i){const o=this.dictionary.position,a=this.pos_buffer.position;return this.dictionary.putShort(t),this.dictionary.putShort(e),this.dictionary.putShort(n),this.dictionary.putInt(a),this.pos_buffer.putString(r+","+i),o}addMapping(t,e){let n=this.target_map[t];n==null&&(n=[]),n.push(e),this.target_map[t]=n}targetMapToBuffer(){const t=new k,e=Object.keys(this.target_map).length;t.putInt(e);for(const n in this.target_map){const r=this.target_map[n],i=r.length;t.putInt(parseInt(n)),t.putInt(i);for(let o=0;o<r.length;o++)t.putInt(r[o])}return t.shrink()}loadDictionary(t){return this.dictionary=new k(t),this}loadPosVector(t){return this.pos_buffer=new k(t),this}loadTargetMap(t){const e=new k(t);for(e.position=0,this.target_map={},e.readInt();!(e.buffer.length<e.position+1);){const n=e.readInt(),r=e.readInt();for(let i=0;i<r;i++){const o=e.readInt();this.addMapping(n,o)}}return this}getFeatures(t){const e=parseInt(t);if(isNaN(e))return"";const n=this.dictionary.getInt(e+6);return this.pos_buffer.getString(n)}},q=zt,Dt=class{constructor(t,e){u(this,"forward_dimension");u(this,"backward_dimension");u(this,"buffer");this.forward_dimension=t,this.backward_dimension=e,this.buffer=new Int16Array(t*e+2),this.buffer[0]=t,this.buffer[1]=e}put(t,e,n){const r=t*this.backward_dimension+e+2;if(this.buffer.length<r+1)throw"ConnectionCosts buffer overflow";this.buffer[r]=n}get(t,e){const n=t*this.backward_dimension+e+2;if(this.buffer.length<n+1)throw"ConnectionCosts buffer overflow";return this.buffer[n]}loadConnectionCosts(t){this.forward_dimension=t[0],this.backward_dimension=t[1],this.buffer=t}},jt=Dt,Pt=class{constructor(t,e,n,r,i){u(this,"class_id");u(this,"class_name");u(this,"is_always_invoke");u(this,"is_grouping");u(this,"max_length");this.class_id=t,this.class_name=e,this.is_always_invoke=n,this.is_grouping=r,this.max_length=i}},J=Pt,Mt=class ht{constructor(){u(this,"map");u(this,"lookup_table");this.map=[],this.lookup_table={}}init(e){if(e!=null)for(let n=0;n<e.length;n++){const r=e[n];this.map[n]=r,this.lookup_table[r.class_name]=n}}getCharacterClass(e){return this.map[e]}lookup(e){const n=this.lookup_table[e];return n??null}toBuffer(){const e=new k;for(let n=0;n<this.map.length;n++){const r=this.map[n];e.put(r.is_always_invoke),e.put(r.is_grouping),e.putInt(r.max_length),e.putString(r.class_name)}return e.shrink(),e.buffer}static load(e){const n=new ht,r=[],i=new k(e);for(;i.position+1<i.size();){const o=r.length,a=i.get(),s=i.get(),c=i.getInt(),l=i.getString();r.push(new J(o,l,a,s,c))}return n.init(r),n}},Ft=Mt,V="DEFAULT",Rt=class _t{constructor(){u(this,"character_category_map");u(this,"compatible_category_map");u(this,"invoke_definition_map");this.character_category_map=new Uint8Array(65536),this.compatible_category_map=new Uint32Array(65536),this.invoke_definition_map=null}initCategoryMappings(e){let n;if(e!=null)for(let i=0;i<e.length;i++){const o=e[i],a=o.end||o.start;for(n=o.start;n<=a;n++){this.character_category_map[n]=this.invoke_definition_map.lookup(o.default);for(let s=0;s<o.compatible.length;s++){let c=this.compatible_category_map[n];const l=o.compatible[s];if(l==null)continue;const f=this.invoke_definition_map.lookup(l);if(f==null)continue;const h=1<<f;c=c|h,this.compatible_category_map[n]=c}}}const r=this.invoke_definition_map.lookup(V);if(r!=null)for(n=0;n<this.character_category_map.length;n++)this.character_category_map[n]===0&&(this.character_category_map[n]=1<<r)}lookupCompatibleCategory(e){const n=[],r=e.charCodeAt(0);let i;if(r<this.compatible_category_map.length&&(i=this.compatible_category_map[r]),i==null||i===0)return n;for(let o=0;o<32;o++)if(i<<31-o>>>31===1){const a=this.invoke_definition_map.getCharacterClass(o);if(a==null)continue;n.push(a)}return n}lookup(e){let n;const r=e.charCodeAt(0);return O.isSurrogatePair(e)?n=this.invoke_definition_map.lookup(V):r<this.character_category_map.length&&(n=this.character_category_map[r]),n==null&&(n=this.invoke_definition_map.lookup(V)),this.invoke_definition_map.getCharacterClass(n)}static load(e,n,r){const i=new _t;return i.character_category_map=e,i.compatible_category_map=n,i.invoke_definition_map=Ft.load(r),i}static parseCharCategory(e,n){const r=n[1],i=parseInt(n[2]),o=parseInt(n[3]),a=parseInt(n[4]);if(!isFinite(i)||i!==0&&i!==1)return console.log("char.def parse error. INVOKE is 0 or 1 in:"+i),null;if(!isFinite(o)||o!==0&&o!==1)return console.log("char.def parse error. GROUP is 0 or 1 in:"+o),null;if(!isFinite(a)||a<0)return console.log("char.def parse error. LENGTH is 1 to n:"+a),null;const s=i===1,c=o===1;return new J(e,r,s,c,a)}static parseCategoryMapping(e){const n=parseInt(e[1]),r=e[2],i=3<e.length?e.slice(3):[];return(!isFinite(n)||n<0||n>65535)&&console.log("char.def parse error. CODE is invalid:"+n),{start:n,default:r,compatible:i}}static parseRangeCategoryMapping(e){const n=parseInt(e[1]),r=parseInt(e[2]),i=e[3],o=4<e.length?e.slice(4):[];return(!isFinite(n)||n<0||n>65535)&&console.log("char.def parse error. CODE is invalid:"+n),(!isFinite(r)||r<0||r>65535)&&console.log("char.def parse error. CODE is invalid:"+r),{start:n,end:r,default:i,compatible:o}}},xt=Rt,Vt=class extends q{constructor(){super();u(this,"character_definition");this.dictionary=new k(10*1024*1024),this.target_map={},this.pos_buffer=new k(10*1024*1024),this.character_definition=null}characterDefinition(e){return this.character_definition=e,this}lookup(e){var n;return(n=this.character_definition)==null?void 0:n.lookup(e)}lookupCompatibleCategory(e){var n;return(n=this.character_definition)==null?void 0:n.lookupCompatibleCategory(e)}loadUnknownDictionaries(e,n,r,i,o,a){this.loadDictionary(e),this.loadPosVector(n),this.loadTargetMap(r),this.character_definition=xt.load(i,o,a)}},Lt=Vt,Ht=class{constructor(t,e,n,r){u(this,"trie");u(this,"token_info_dictionary");u(this,"connection_costs");u(this,"unknown_dictionary");t!=null?this.trie=t:this.trie=It(0).build([{k:"",v:1}]),e!=null?this.token_info_dictionary=e:this.token_info_dictionary=new q,n!=null?this.connection_costs=n:this.connection_costs=new jt(0,0),r!=null?this.unknown_dictionary=r:this.unknown_dictionary=new Lt}loadTrie(t,e){return this.trie=Bt(t,e),this}loadTokenInfoDictionaries(t,e,n){return this.token_info_dictionary.loadDictionary(t),this.token_info_dictionary.loadPosVector(e),this.token_info_dictionary.loadTargetMap(n),this}loadConnectionCosts(t){return this.connection_costs.loadConnectionCosts(t),this}loadUnknownDictionaries(t,e,n,r,i,o){return this.unknown_dictionary.loadUnknownDictionaries(t,e,n,r,i,o),this}},Wt=Ht;async function Gt(t){const e=new Wt;async function n(){const a=["base.dat.gz","check.dat.gz"],s=await Promise.all(a.map(f=>t.loadArrayBuffer(f))),c=new Int32Array(s[0]),l=new Int32Array(s[1]);e.loadTrie(c,l)}async function r(){const a=["tid.dat.gz","tid_pos.dat.gz","tid_map.dat.gz"],s=await Promise.all(a.map(h=>t.loadArrayBuffer(h))),c=new Uint8Array(s[0]),l=new Uint8Array(s[1]),f=new Uint8Array(s[2]);e.loadTokenInfoDictionaries(c,l,f)}async function i(){const a=await t.loadArrayBuffer("cc.dat.gz"),s=new Int16Array(a);e.loadConnectionCosts(s)}async function o(){const a=["unk.dat.gz","unk_pos.dat.gz","unk_map.dat.gz","unk_char.dat.gz","unk_compat.dat.gz","unk_invoke.dat.gz"],s=await Promise.all(a.map(v=>t.loadArrayBuffer(v))),c=new Uint8Array(s[0]),l=new Uint8Array(s[1]),f=new Uint8Array(s[2]),h=new Uint8Array(s[3]),_=new Uint32Array(s[4]),p=new Uint8Array(s[5]);e.loadUnknownDictionaries(c,l,f,h,_,p)}return await Promise.all([n(),r(),i(),o()]),e}var $t=class{constructor(t){this.options=t}async build(){const t=await Gt(this.options.loader);return new At(t)}},Kt=$t;/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Q=Symbol("Comlink.proxy"),Yt=Symbol("Comlink.endpoint"),Xt=Symbol("Comlink.releaseProxy"),L=Symbol("Comlink.finalizer"),z=Symbol("Comlink.thrown"),Z=t=>typeof t=="object"&&t!==null||typeof t=="function",qt={canHandle:t=>Z(t)&&t[Q],serialize(t){const{port1:e,port2:n}=new MessageChannel;return H(t,e),[n,[n]]},deserialize(t){return t.start(),te(t)}},Jt={canHandle:t=>Z(t)&&z in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},tt=new Map([["proxy",qt],["throw",Jt]]);function Qt(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function H(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!Qt(n,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:a,path:s}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(S);let l;try{const f=s.slice(0,-1).reduce((_,p)=>_[p],t),h=s.reduce((_,p)=>_[p],t);switch(a){case"GET":l=h;break;case"SET":f[s.slice(-1)[0]]=S(i.data.value),l=!0;break;case"APPLY":l=h.apply(f,c);break;case"CONSTRUCT":{const _=new h(...c);l=oe(_)}break;case"ENDPOINT":{const{port1:_,port2:p}=new MessageChannel;H(t,p),l=ie(_,[_])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[z]:0}}Promise.resolve(l).catch(f=>({value:f,[z]:0})).then(f=>{const[h,_]=M(f);e.postMessage(Object.assign(Object.assign({},h),{id:o}),_),a==="RELEASE"&&(e.removeEventListener("message",r),et(e),L in t&&typeof t[L]=="function"&&t[L]())}).catch(f=>{const[h,_]=M({value:new TypeError("Unserializable return value"),[z]:0});e.postMessage(Object.assign(Object.assign({},h),{id:o}),_)})}),e.start&&e.start()}function Zt(t){return t.constructor.name==="MessagePort"}function et(t){Zt(t)&&t.close()}function te(t,e){const n=new Map;return t.addEventListener("message",function(i){const{data:o}=i;if(!o||!o.id)return;const a=n.get(o.id);if(a)try{a(o)}finally{n.delete(o.id)}}),W(t,n,[],e)}function D(t){if(t)throw new Error("Proxy has been released and is not useable")}function nt(t){return T(t,new Map,{type:"RELEASE"}).then(()=>{et(t)})}const j=new WeakMap,P="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(j.get(t)||0)-1;j.set(t,e),e===0&&nt(t)});function ee(t,e){const n=(j.get(e)||0)+1;j.set(e,n),P&&P.register(t,e,t)}function ne(t){P&&P.unregister(t)}function W(t,e,n=[],r=function(){}){let i=!1;const o=new Proxy(r,{get(a,s){if(D(i),s===Xt)return()=>{ne(o),nt(t),e.clear(),i=!0};if(s==="then"){if(n.length===0)return{then:()=>o};const c=T(t,e,{type:"GET",path:n.map(l=>l.toString())}).then(S);return c.then.bind(c)}return W(t,e,[...n,s])},set(a,s,c){D(i);const[l,f]=M(c);return T(t,e,{type:"SET",path:[...n,s].map(h=>h.toString()),value:l},f).then(S)},apply(a,s,c){D(i);const l=n[n.length-1];if(l===Yt)return T(t,e,{type:"ENDPOINT"}).then(S);if(l==="bind")return W(t,e,n.slice(0,-1));const[f,h]=rt(c);return T(t,e,{type:"APPLY",path:n.map(_=>_.toString()),argumentList:f},h).then(S)},construct(a,s){D(i);const[c,l]=rt(s);return T(t,e,{type:"CONSTRUCT",path:n.map(f=>f.toString()),argumentList:c},l).then(S)}});return ee(o,t),o}function re(t){return Array.prototype.concat.apply([],t)}function rt(t){const e=t.map(M);return[e.map(n=>n[0]),re(e.map(n=>n[1]))]}const it=new WeakMap;function ie(t,e){return it.set(t,e),t}function oe(t){return Object.assign(t,{[Q]:!0})}function M(t){for(const[e,n]of tt)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:t},it.get(t)||[]]}function S(t){switch(t.type){case"HANDLER":return tt.get(t.name).deserialize(t.value);case"RAW":return t.value}}function T(t,e,n,r){return new Promise(i=>{const o=se();e.set(o,i),t.start&&t.start(),t.postMessage(Object.assign({id:o},n),r)})}function se(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var ae=typeof global=="object"&&global&&global.Object===Object&&global,ce=typeof self=="object"&&self&&self.Object===Object&&self,le=ae||ce||Function("return this")(),F=le.Symbol,ot=Object.prototype,fe=ot.hasOwnProperty,ue=ot.toString,B=F?F.toStringTag:void 0;function he(t){var e=fe.call(t,B),n=t[B];try{t[B]=void 0;var r=!0}catch{}var i=ue.call(t);return r&&(e?t[B]=n:delete t[B]),i}var _e=Object.prototype,pe=_e.toString;function de(t){return pe.call(t)}var ge="[object Null]",ye="[object Undefined]",st=F?F.toStringTag:void 0;function be(t){return t==null?t===void 0?ye:ge:st&&st in Object(t)?he(t):de(t)}function me(t){return t!=null&&typeof t=="object"}var ke="[object Symbol]";function we(t){return typeof t=="symbol"||me(t)&&be(t)==ke}var ve=/\s/;function Ce(t){for(var e=t.length;e--&&ve.test(t.charAt(e)););return e}var Ae=/^\s+/;function Se(t){return t&&t.slice(0,Ce(t)+1).replace(Ae,"")}function at(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var ct=NaN,Ee=/^[-+]0x[0-9a-f]+$/i,Te=/^0b[01]+$/i,Ie=/^0o[0-7]+$/i,Be=parseInt;function Oe(t){if(typeof t=="number")return t;if(we(t))return ct;if(at(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=at(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Se(t);var n=Te.test(t);return n||Ie.test(t)?Be(t.slice(2),n?2:8):Ee.test(t)?ct:+t}var lt=1/0,Ue=17976931348623157e292;function Ne(t){if(!t)return t===0?t:0;if(t=Oe(t),t===lt||t===-lt){var e=t<0?-1:1;return e*Ue}return t===t?t:0}function ze(t){var e=Ne(t),n=e%1;return e===e?n?e-n:e:0}var De="Expected a function";function je(t,e){var n;if(typeof e!="function")throw new TypeError(De);return t=ze(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=void 0),n}}function Pe(t){return je(2,t)}const Me={async loadArrayBuffer(t){t=t.replace(".gz","");const e=await fetch("https://cdn.jsdelivr.net/npm/@aiktb/kuromoji@1.0.2/dict/"+t);if(!e.ok)throw new Error(`Failed to fetch ${t}, status: ${e.status}`);return e.arrayBuffer()}},Fe=Pe(()=>new Kt({loader:Me}).build());async function Re(t){return(await Fe()).tokenize(t)}H({tokenize:Re})})();
